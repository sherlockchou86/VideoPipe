<p style="" align="center">
  <img src="./doc/logo.png" alt="Logo" width="75%">
</p>
<p style="margin:0px" align="center">
  <a href='./README.md'>è‹±æ–‡README</a> | <a href='http://www.videopipe.cool'>VideoPipeç½‘ç«™</a> | <a href='http://www.videopipe.cool/index.php/2024/09/11/videopipetutorials/'>VideoPipeè§†é¢‘æ•™ç¨‹</a>
</p>
<p style="margin:0px" align="center">
  <a href='https://github.com/sherlockchou86/one-yolo'>ğŸš€one-yolo, make all in one for Yolo integration. All Tasks, All Versions, All Runtimes. ğŸš€</a>
</p>

---

## ä¸€ã€ä»‹ç»

`VideoPipe` æ˜¯ä¸€ä¸ªç”¨äºè§†é¢‘åˆ†æå’Œç»“æ„åŒ–çš„æ¡†æ¶ï¼Œé‡‡ç”¨ C++ ç¼–å†™ã€ä¾èµ–å°‘ã€æ˜“ä¸Šæ‰‹ã€‚å®ƒåƒç®¡é“ä¸€æ ·ï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹ç›¸äº’ç‹¬ç«‹å¹¶å¯è‡ªè¡Œæ­é…ï¼Œ`VideoPipe` å¯ç”¨æ¥æ„å»ºä¸åŒç±»å‹çš„è§†é¢‘åˆ†æåº”ç”¨ï¼Œé€‚ç”¨äºè§†é¢‘ç»“æ„åŒ–ã€å›¾ç‰‡æœç´¢ã€äººè„¸è¯†åˆ«ã€äº¤é€š/å®‰é˜²é¢†åŸŸçš„è¡Œä¸ºåˆ†æï¼ˆå¦‚äº¤é€šäº‹ä»¶æ£€æµ‹ï¼‰ç­‰åœºæ™¯ã€‚

![](./doc/g1.gif)

## äºŒã€ä¼˜åŠ¿å’Œç‰¹ç‚¹

`VideoPipe` ç±»ä¼¼äºè‹±ä¼Ÿè¾¾çš„ DeepStream å’Œåä¸ºçš„ mxVision æ¡†æ¶ï¼Œä½†å®ƒæ›´æ˜“äºä½¿ç”¨ã€æ›´å…·å¤‡å¯ç§»æ¤æ€§ã€‚

|åç§°|æ˜¯å¦å¼€æº|å­¦ä¹ é—¨æ§›|é€‚ç”¨å¹³å°|æ€§èƒ½|ä¸‰æ–¹ä¾èµ–|
|--|--|--|--|--|--|
|DeepStream|å¦|é«˜|ä»…é™è‹±ä¼Ÿè¾¾|é«˜|å¤š|
|mxVision|å¦|é«˜|ä»…é™åä¸º|é«˜|å¤š|
|VideoPipe|æ˜¯|ä½|ä¸é™å¹³å°|ä¸­|å°‘|

`VideoPipe` é‡‡ç”¨é¢å‘æ’ä»¶çš„ç¼–ç é£æ ¼ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚æŒ‰éœ€æ­é…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‹¬ç«‹çš„æ’ä»¶ï¼ˆå³æ¡†æ¶ä¸­çš„ `Node` ç±»å‹ï¼‰ï¼Œæ¥æ„å»ºä¸åŒç±»å‹çš„è§†é¢‘åˆ†æåº”ç”¨ã€‚ä½ åªéœ€å‡†å¤‡å¥½æ¨¡å‹å¹¶äº†è§£å¦‚ä½•è§£æå…¶è¾“å‡ºå³å¯ï¼Œæ¨ç†å¯ä»¥åŸºäºä¸åŒçš„åç«¯å®ç°ï¼Œå¦‚ OpenCV::DNNï¼ˆé»˜è®¤ï¼‰ã€TensorRTã€PaddleInferenceã€ONNXRuntime ç­‰ï¼Œä»»ä½•ä½ å–œæ¬¢çš„éƒ½å¯ä»¥ã€‚

![](./doc/p1-1.png)

## ä¸‰ã€æ¼”ç¤º

https://github.com/sherlockchou86/video_pipe_c/assets/13251045/b1289faa-e2c7-4d38-871e-879ae36f6d50

æ’­æ”¾å™¨å³ä¸‹è§’å…¨å±è§‚çœ‹ï¼Œ[æ›´å¤šè§†é¢‘æ¼”ç¤º](./SAMPLES.md)

## å››ã€åŠŸèƒ½

VideoPipe æ˜¯ä¸€ä¸ªè®©è®¡ç®—æœºè§†è§‰ç®—æ³•æ¨¡å‹é›†æˆæ›´åŠ ç®€å•çš„æ¡†æ¶ï¼Œæ³¨æ„å®ƒä¸æ˜¯åƒ TensorFlowã€TensorRT ç±»ä¼¼çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚VideoPipeä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š

- æµè¯»å–ï¼šâ½€æŒä¸»æµçš„è§†é¢‘æµåè®®ï¼Œå¦‚ udpã€rtspã€rtmpã€fileã€applicationã€‚åŒæ—¶æ”¯æŒå›¾ç‰‡è¯»å–ã€‚
- è§†é¢‘è§£ç ï¼šâ½€æŒåŸºäº OpenCV/GStreamer çš„è§†é¢‘å’Œå›¾ç‰‡è§£ç ï¼ˆâ½€æŒç¡¬ä»¶åŠ é€Ÿï¼‰ã€‚
- ç®—æ³•æ¨ç†ï¼šâ½€æŒåŸºäºæ·±åº¦å­¦ä¹ ç®—æ³•çš„å¤šçº§æ¨ç†ï¼Œä¾‹å¦‚â½¬æ ‡æ£€æµ‹ã€å›¾åƒåˆ†ç±»ã€ç‰¹å¾æå–ã€å›¾åƒç”Ÿæˆç­‰ç›¸å…³ç½‘ç»œé›†æˆã€‚åŒæ—¶æ”¯æŒä¼ ç»Ÿå›¾åƒç®—æ³•é›†æˆã€‚**æ”¯æŒå¤šæ¨¡æ€å¤§æ¨¡å‹ï¼ˆmLLMï¼‰é›†æˆï¼ˆ2025/8/12æ›´æ–°ï¼‰**
- â½¬æ ‡è·Ÿè¸ªï¼šâ½€æŒâ½¬æ ‡è¿½è¸ªï¼Œä¾‹å¦‚ IOUã€SORT è·Ÿè¸ªç®—æ³•ç­‰ã€‚
- â¾ä¸ºåˆ†æï¼ˆBAï¼‰ï¼šâ½€æŒåŸºäºè·Ÿè¸ªçš„â¾ä¸ºåˆ†æï¼Œä¾‹å¦‚è¶Šçº¿ã€åœâ»‹ã€è¿ç« ç­‰äº¤é€šè¡Œä¸ºåˆ¤æ–­ã€‚
- ä¸šåŠ¡é€»è¾‘ï¼šæ”¯æŒä»»æ„è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘çš„é›†æˆï¼Œå¯ä»¥ä¸ä¸šåŠ¡å¼ºç›¸å…³ã€‚
- æ•°æ®ä»£ç†ï¼šâ½€æŒå°†ç»“æ„åŒ–æ•°æ®ï¼ˆjson/xml/â¾ƒå®šä¹‰æ ¼å¼ï¼‰ä»¥ kafka/Sokcet ç­‰â½…å¼æ¨é€åˆ°äº‘ç«¯ã€æ–‡ä»¶æˆ–å…¶ä»–ç¬¬ä¸‰â½…å¹³å°ã€‚
- å½•åˆ¶ï¼šâ½€æŒç‰¹å®šæ—¶é—´æ®µçš„è§†é¢‘å½•åˆ¶ï¼Œç‰¹å®šå¸§çš„æˆªå›¾ï¼Œå¹¶å­˜æ–‡ä»¶ã€‚
- å±å¹•æ˜¾â½°ï¼ˆOSDï¼‰ï¼šæ”¯æŒå°†ç»“æ„åŒ–æ•°æ®ã€ä¸šåŠ¡é€»è¾‘å¤„ç†ç»“æœç»˜åˆ¶åˆ°å¸§ä¸Šã€‚
- è§†é¢‘ç¼–ç ï¼šâ½€æŒåŸºäº OpenCV/GStreamer çš„è§†é¢‘å’Œå›¾ç‰‡ç¼–ç ï¼ˆâ½€æŒç¡¬ä»¶åŠ é€Ÿï¼‰ã€‚
- æµæ¨é€ï¼šâ½€æŒä¸»æµçš„è§†é¢‘æµåè®®ï¼Œå¦‚ udpã€rtspã€rtmpã€fileã€applicationã€‚åŒæ—¶æ”¯æŒå›¾ç‰‡æ¨é€ã€‚

## äº”ã€å¿«é€Ÿä¸Šæ‰‹

### 5.1 ä¾èµ–

å¹³å°
- Ubuntu 18.04 x86_64 NVIDIA rtx/tesla GPUs
- Ubuntu 18.04 aarch64 NVIDIA jetson serials deviceï¼Œtx2 tested
- Ubuntu 22.04 x86_64 by VMware virtual machine on Windows 10, pure CPUs
- Ubuntu 18.04 x86_64 Cambrian MLU serials device, MLU 370 tested (code not provided)
- Ubuntu 18.04 aarch64 Rockchip RK35** serials device, RK3588 tested (code not provided)
- Ubuntu 22.04 aarch64 Ascend 310/910 serials device, Atlas 300I-Pro tested (code not provided)
- Wait for your test

åŸºç¡€
- C++ 17
- OpenCV >= 4.6
- GStreamer 1.14.5 (Required by OpenCV)
- GCC >= 7.5

å¯é€‰ï¼Œå¦‚æœä½ éœ€è¦å®ç°è‡ªå·±çš„æ¨ç†åç«¯ï¼Œæˆ–è€…ä½¿ç”¨é™¤ `opencv::dnn` ä¹‹å¤–çš„å…¶ä»–æ¨ç†åç«¯.
- CUDA
- TensorRT
- Paddle Inference
- ONNX Runtime
- mLLMï¼ˆOllama/vLLM/OpenAI-compatible API Servicesï¼‰
- Anything you like

[å¦‚ä½•å®‰è£…CUDAå’ŒTensorRT](./third_party/trt_vehicle/README.md)

[å¦‚ä½•å®‰è£…Paddle_Inference](./third_party/paddle_ocr/README.md)

### 5.2 ç¼–è¯‘å’Œè°ƒè¯•

1. è¿è¡Œ `git clone https://github.com/sherlockchou86/VideoPipe.git`
2. è¿è¡Œ `cd VideoPipe`
3. è¿è¡Œ `mkdir build && cd build`
4. è¿è¡Œ `cmake ..`
5. è¿è¡Œ `make -j8`

ç¼–è¯‘å®Œæˆåï¼Œæ‰€æœ‰çš„åº“æ–‡ä»¶å­˜æ”¾åœ¨ `build/libs` ä¸­ï¼Œæ‰€æœ‰çš„ Sample è¿è¡Œæ–‡ä»¶å­˜æ”¾åœ¨ `build/bin` ä¸­ã€‚åœ¨æ‰§è¡Œç¬¬ 4 æ­¥çš„æ—¶å€™ï¼Œå¯ä»¥æ·»åŠ ä¸€äº›ç¼–è¯‘é€‰é¡¹ï¼š
- -DVP_WITH_CUDA=ON ï¼ˆç¼–è¯‘ CUDA ç›¸å…³åŠŸèƒ½ï¼Œé»˜è®¤ä¸º OFFï¼‰
- -DVP_WITH_TRT=ON ï¼ˆç¼–è¯‘ TensorRT ç›¸å…³åŠŸèƒ½å’Œ Samplesï¼Œé»˜è®¤ä¸º OFFï¼‰
- -DVP_WITH_PADDLE=ON ï¼ˆç¼–è¯‘ PaddlePaddle ç›¸å…³åŠŸèƒ½å’Œ Samplesï¼Œé»˜è®¤ä¸º OFFï¼‰
- -DVP_WITH_KAFKA=ON ï¼ˆç¼–è¯‘ Kafka ç›¸å…³åŠŸèƒ½å’Œ Samplesï¼Œé»˜è®¤ä¸º OFFï¼‰
- -DVP_WITH_LLM=ON ï¼ˆç¼–è¯‘ LLM ç›¸å…³åŠŸèƒ½å’Œ Samplesï¼Œé»˜è®¤ä¸º OFFï¼‰
- -DVP_BUILD_COMPLEX_SAMPLES=ON ï¼ˆç¼–è¯‘é«˜çº§ Samplesï¼Œé»˜è®¤ä¸º OFFï¼‰

æ¯”å¦‚éœ€è¦å¼€å¯CUDAå’ŒTensorRTç›¸å…³çš„æ¨¡å—ï¼Œå¯ä»¥è¿è¡Œ `cmake -DVP_WITH_CUDA=ON -DVP_WITH_TRT=ON ..`ã€‚å¦‚æœåªè¿è¡Œ `cmake ..`ï¼Œé‚£ä¹ˆæ‰€æœ‰ä»£ç è¿è¡Œåœ¨ CPU ä¸Šã€‚

```
# å¼€å¯å…¨éƒ¨
cmake -DVP_WITH_CUDA=ON \
-DVP_WITH_TRT=ON \
-DVP_WITH_PADDLE=ON \
-DVP_WITH_KAFKA=ON \
-DVP_BUILD_COMPLEX_SAMPLES=ON ..

# å…³é—­å…¨éƒ¨ï¼ˆé»˜è®¤ï¼‰
cmake ..
```

å¦‚æœè¦è¿è¡Œç¼–è¯‘ç”Ÿæˆçš„ Samplesï¼Œå…ˆä¸‹è½½æ¨¡å‹æ–‡ä»¶å’Œæµ‹è¯•æ•°æ®ï¼š

1. [è°·æ­Œç½‘ç›˜ä¸‹è½½æµ‹è¯•æ–‡ä»¶å’Œæ¨¡å‹](https://drive.google.com/drive/folders/1v9dVcR6xttUTB-WPsH3mZ_ZZMzD4wG-v?usp=sharing)
2. [ç™¾åº¦ç½‘ç›˜ä¸‹è½½æµ‹è¯•æ–‡ä»¶å’Œæ¨¡å‹](https://pan.baidu.com/s/1jr2nBnEDmuNaM5DiMjbC0g?pwd=nf53)

å°†ä¸‹è½½å¥½çš„ç›®å½•ï¼ˆåç§°ä¸º vp_dataï¼‰æ”¾åœ¨ä»»ä½•ä½ç½®ï¼ˆæ¯”å¦‚æ”¾åœ¨ `/root/abc` ä¸‹é¢ï¼‰ï¼Œç„¶ååœ¨ `åŒä¸€ç›®å½•` ä¸‹è¿è¡Œ Sampleï¼Œæ¯”å¦‚åœ¨ `/root/abc` ä¸‹é¢æ‰§è¡Œå‘½ä»¤ï¼š`[path to VideoPipe]/build/bin/1-1-1_sample` å³å¯è¿è¡Œ 1-1-1_sampleã€‚

**æ³¨æ„**ï¼š`./third_party/` ä¸‹é¢éƒ½æ˜¯ç‹¬ç«‹çš„é¡¹ç›®ï¼Œæœ‰çš„æ˜¯ header-only åº“ï¼Œè¢« VideoPipe ç›´æ¥å¼•ç”¨ï¼›æœ‰çš„åŒ…å«æœ‰ cpp æ–‡ä»¶ï¼Œå¯ä»¥ç‹¬ç«‹ç¼–è¯‘æˆ–è¿è¡Œï¼ŒVideoPipe ä¾èµ–è¿™äº›åº“ï¼Œåœ¨ç¼–è¯‘ VideoPipe çš„è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨ç¼–è¯‘è¿™äº›åº“ã€‚è¿™äº›åº“ä¹ŸåŒ…å«è‡ªå·±çš„ Samplesï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¯å‚è§å¯¹åº”å­ç›®å½•ä¸‹çš„ README æ–‡ä»¶.

### 5.3 å¦‚ä½•ä½¿ç”¨

1. å…ˆå°† VideoPipe ç¼–è¯‘æˆåº“ï¼Œç„¶åå¼•ç”¨å®ƒ.
2. æˆ–è€…ç›´æ¥å¼•ç”¨æºä»£ç ï¼Œç„¶åç¼–è¯‘æ•´ä¸ªApplication.

ä¸‹é¢æ˜¯ä¸€ä¸ªå¦‚ä½•æ„å»º Pipeline ç„¶åè¿è¡Œçš„ Sample(è¯·å…ˆä¿®æ”¹ä»£ç ä¸­çš„ç›¸å…³æ–‡ä»¶è·¯å¾„)ï¼š

```c++
#include "../nodes/vp_file_src_node.h"
#include "../nodes/infers/vp_yunet_face_detector_node.h"
#include "../nodes/infers/vp_sface_feature_encoder_node.h"
#include "../nodes/osd/vp_face_osd_node_v2.h"
#include "../nodes/vp_screen_des_node.h"
#include "../nodes/vp_rtmp_des_node.h"
#include "../utils/analysis_board/vp_analysis_board.h"

/*
* åç§°ï¼š1-1-N sample
* å®Œæ•´ä»£ç ä½äºï¼šsamples/1-1-N_sample.cpp
* åŠŸèƒ½è¯´æ˜ï¼š1ä¸ªè§†é¢‘è¾“å…¥ï¼Œ1ä¸ªè§†é¢‘åˆ†æä»»åŠ¡ï¼ˆäººè„¸æ£€æµ‹å’Œè¯†åˆ«ï¼‰ï¼Œ2ä¸ªè¾“å‡ºï¼ˆå±å¹•è¾“å‡º/RTMPæ¨æµè¾“å‡ºï¼‰
*/

int main() {
    VP_SET_LOG_INCLUDE_CODE_LOCATION(false);
    VP_SET_LOG_INCLUDE_THREAD_ID(false);
    VP_LOGGER_INIT();

    // 1ã€åˆ›å»ºèŠ‚ç‚¹
    // è§†é¢‘è·å– Node
    auto file_src_0 = std::make_shared<vp_nodes::vp_file_src_node>("file_src_0", 0, "./test_video/10.mp4", 0.6);
    // 2ã€æ¨¡å‹æ¨ç† Node
    // ä¸€çº§æ¨ç†ï¼šäººè„¸æ£€æµ‹
    auto yunet_face_detector_0 = std::make_shared<vp_nodes::vp_yunet_face_detector_node>("yunet_face_detector_0", "./models/face/face_detection_yunet_2022mar.onnx");
    // äºŒçº§æ¨ç†ï¼šäººè„¸è¯†åˆ«
    auto sface_face_encoder_0 = std::make_shared<vp_nodes::vp_sface_feature_encoder_node>("sface_face_encoder_0", "./models/face/face_recognition_sface_2021dec.onnx");
    // 3ã€OSD Node
    // å¤„ç†ç»“æœç»˜åˆ¶åˆ°å¸§ä¸Š
    auto osd_0 = std::make_shared<vp_nodes::vp_face_osd_node_v2>("osd_0");
    // å±å¹•å±•ç¤º
    auto screen_des_0 = std::make_shared<vp_nodes::vp_screen_des_node>("screen_des_0", 0);
    // æ¨æµå±•ç¤º
    auto rtmp_des_0 = std::make_shared<vp_nodes::vp_rtmp_des_node>("rtmp_des_0", 0, "rtmp://192.168.77.60/live/10000");

    // æ„å»ºç®¡é“ï¼Œå°†èŠ‚ç‚¹çš„å¤„ç†ç»“æœå…³è”èµ·æ¥
    yunet_face_detector_0->attach_to({file_src_0});
    sface_face_encoder_0->attach_to({yunet_face_detector_0});
    osd_0->attach_to({sface_face_encoder_0});

    // ç®¡é“è‡ªåŠ¨æ‹†åˆ†ï¼Œé€šè¿‡å±å¹•/æ¨æµè¾“å‡ºç»“æœ
    screen_des_0->attach_to({osd_0});
    rtmp_des_0->attach_to({osd_0});

    // å¯åŠ¨ç®¡é“
    file_src_0->start();

    // å¯è§†åŒ–ç®¡é“
    vp_utils::vp_analysis_board board({file_src_0});
    board.display();
}
```
ä¸Šé¢ä»£ç è¿è¡Œåï¼Œä¼šå‡ºç° 3 ä¸ªç”»é¢:
1. ç®¡é“çš„è¿è¡ŒçŠ¶æ€å›¾ï¼ŒçŠ¶æ€è‡ªåŠ¨åˆ·æ–°
2. å±å¹•æ˜¾ç¤ºç»“æœï¼ˆGUIï¼‰
3. æ’­æ”¾å™¨æ˜¾ç¤ºç»“æœï¼ˆRTMPï¼‰

![](./doc/g3.png)


### 5.4 æ¡ˆä¾‹åŸå‹
|ID|Sample|æˆªå›¾|
|--|--|--|
|1|face_tracking_sample|![](./doc/p18.png)|
|2|vehicle_tracking_sample|![](./doc/p22.png)|
|3|mask_rcnn_sample|![](./doc/p30.png)|
|4|openpose_sample|![](./doc/p31.png)|
|5|face_swap_sample|![](./doc/p57.png)|
|6|mllm_analyse_sample|![](./doc/p69.png)|

å…±è®¡ 40 å¤šä¸ªåŸå‹æ¡ˆä¾‹ï¼Œ[ç‚¹å‡»](./SAMPLES.md)æŸ¥çœ‹æ›´å¤šã€‚

## å…­ã€æ›´å¤šèµ„æ–™
- [Sample Code](./samples)
- [Node Table](./nodes/README.md)
- [How VideoPipe Works](./doc/about.md)
- [Development Environment For Reference](./doc/env.md)

## æ‰«ç å…¥ç¾¤äº¤æµ
![](./doc/vx.png)

## é¸£è°¢

<a href="https://hellogithub.com/repository/4284d29e778642a4a51a471ab1eae6f0" target="_blank"><img src="https://api.hellogithub.com/v1/widgets/recommend.svg?rid=4284d29e778642a4a51a471ab1eae6f0&claim_uid=hBZTk0E2RAzJKyq" alt="Featuredï½œHelloGitHub" style="width: 250px; height: 54px;" width="250" height="54" /></a>
